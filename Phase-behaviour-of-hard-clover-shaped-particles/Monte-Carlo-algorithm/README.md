```
                                    ⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢀⣀⣤⣤⣴⣶⡆⠀⣶⣶⣦⣤⣤⣄⠀⢠⣾⣿⣦
                                    ⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⣀⡀⢰⣿⣿⣿⣿⣿⣿⣿⡇⠀⣿⣿⣿⣿⣿⣿⡄⠘⢿⣿⠟
                                    ⠀⠀⠀⠀⠀⠀⠀⠀⢀⣴⣾⣿⣧⠀⢻⣿⣿⣿⣿⣿⣿⡇⠀⣿⣿⣿⣿⣿⣿⣿⠂⢠⣠⣤⣶⣦⡀
                                    ⠀⠀⠀⠀⠀⠀⣠⣾⣿⣿⣿⣿⣿⣇⠈⢿⣿⣿⣿⣿⣿⡇⠀⣿⣿⣿⣿⣿⣿⠏⢀⣿⣿⣿⣿⣿⣿⣦⡀
                                    ⠀⠀⠀⠀⠀⠘⢿⣿⣿⣿⣿⣿⣿⣿⡆⠘⣿⣿⣿⣿⣿⡇⠀⣿⣿⣿⣿⣿⡏⠀⣾⣿⣿⣿⣿⣿⣿⡿⠋⢀
                                    ⠀⠀⠀⣴⣿⣦⡀⠙⢿⣿⣿⣿⣿⣿⣿⡄⠸⣿⣿⣿⣿⡇⠀⣿⣿⣿⣿⡟⠀⣼⣿⣿⣿⣿⣿⣿⠟⢀⣴⣿⣧
                                    ⠀⠀⣼⣿⣿⣿⣿⣦⡀⠙⢿⣿⣿⣿⣿⣷⡀⢹⣿⣿⣿⡇⠀⣿⣿⣿⡿⠁⣰⣿⣿⣿⣿⣿⠟⢁⣴⣿⣿⣿⣿⣧
                                    ⠀⣼⣿⣿⣿⣿⣿⣿⣿⣦⡀⠙⢿⣿⣿⣿⣧⠀⢻⣿⣿⡇⠀⣿⣿⣿⠃⢰⣿⣿⣿⣿⠟⢁⣴⣿⣿⣿⣿⣿⣿⣿⣧
                                    ⠀⠛⠿⢿⣿⣿⣿⣿⣿⣿⣿⣦⡀⠙⢿⣿⣿⣇⠀⢿⣿⡇⠀⣿⣿⠇⢠⣿⣿⣿⠟⢁⣴⣿⣿⣿⣿⣿⣿⣿⣿⡿⠟⠃
                                    ⣼⣶⣤⣄⡈⠙⠛⠿⣿⣿⣿⣿⣿⣦⡀⠙⢿⣿⡆⠈⠛⠃⠀⠛⠋⠀⣾⣿⠟⠁⣠⣾⣿⣿⣿⣿⡿⠿⠛⠉⣀⣠⣴⣶⡄
                                    ⣿⣿⣿⣿⣿⣿⣶⣤⣀⡉⠙⠻⢿⣿⣿⣦⠀⠁⠀⠀⠀⠀⠀⠀⠀⠀⠈⠁⢠⣾⣿⣿⠿⠛⠋⢁⣠⣴⣶⣿⣿⣿⣿⣿⣿⡀
                                    ⢻⣿⣿⣿⣿⣿⣿⣿⣿⣿⣷⣦⣤⣀⠉⠃⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠈⠋⢁⣀⣤⣶⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣧
                                    ⢸⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⡏⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠘⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⡟⠁ ⣠⣶⣄
                                    ⠀⣤⣤⣤⣤⣤⣤⣤⣤⣤⣤⣤⣤⣤⡄⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⣤⣤⣤⣤⣤⣤⣤⣤⣤⣤⣤⣤⣤⣤⡄⠀⢻⣿⣿⡿
                                    ⠀⠘⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⠿⠓⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⣸⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⡿⠂⠀⠙⠋
                                    ⠀⠀⠘⣿⣿⣿⣿⣿⠿⠛⠋⢁⣠⣤⣶⣧⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢰⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⠟⠋
                                    ⠀⠀⠀⠘⠟⠋⢉⣀⣤⣶⣿⣿⣿⣿⠟⠁⣠⣦⣄⡀⠀⠀⠀⠀⠀⠀⣤⣦⡈⠻⣿⣿⣿⣿⣿⣿⣿⣿⣿⡿⠛⠁
                                    ⠀⠀⠀⠀⠀⠘⢿⣿⣿⣿⣿⣿⠟⠁⣠⣾⣿⣿⣿⣿⣿⣶⣶⣾⣧⠀⢻⣿⣿⣦⡈⠻⣿⣿⣿⣿⡿⠟⠉
                                    ⠀⠀⠀⠀⠀⠀⠀⠙⠿⣿⡟⠁⣠⣾⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣇⠈⠿⢿⣿⣿⣦⡈⠻⠛⠉
                                    ⠀⠀⠀⠀⠀⠀⠀⠀⠀⠈⠀⠺⢿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⠋⢀⣤⣤⡈⠙⠋⠁
                                    ⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠉⠙⠛⠻⠿⠿⠿⠿⠿⠿⠇⠀⣿⣿⣿⡇
                                    ⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠈⠙⠋

                         /██   /██   /██   /██   /██████    /██████     /██████    /██      /██   /███████
                        | ██  | ██  | ███ | ██  |_  ██_/   /██__  ██   /██__  ██  | ███    /███  | ██__  ██
                        | ██  | ██  | ████| ██    | ██    | ██  \__/  | ██  \ ██  | ████  /████  | ██  \ ██
                        | ██  | ██  | ██ ██ ██    | ██    | ██        | ████████  | ██ ██/██ ██  | ███████/
                        | ██  | ██  | ██  ████    | ██    | ██        | ██__  ██  | ██  ███| ██  | ██____/
                        | ██  | ██  | ██\  ███    | ██    | ██    ██  | ██  | ██  | ██\  █ | ██  | ██
                        |  ██████/  | ██ \  ██   /██████  |  ██████/  | ██  | ██  | ██ \/  | ██  | ██
                         \______/   |__/  \__/  |______/   \______/   |__/  |__/  |__/     |__/  |__/
```
<p align="right"><b><sub><a href="https://github.com/LESC-Unicamp/Supplementary-materials/blob/main/Phase-behaviour-of-hard-clover-shaped-particles/Monte-Carlo-algorithm/CHANGELOG.md">Version: 1.0.0</a></sub></b></p>

<p align="center"><b>Authors</b></p>
<p align="center">
Nathan Barros de Souza<br>
Luís Fernando Mercier Franco<br>
Carlos Avendaño<br></p>

# <p align="center"><b>NVT/NPT Monte Carlo simulation of nonconvex clover-shaped particles</b></p>

## Contents
1. [Disclaimer](#disclaimer)
2. [Overview](#overview)
3. [Features](#features)
4. [Language](#language)
5. [Building and Compiling](#installation)
6. [Data Input](#datainput)
7. [Files and Folders](#filesandfolders)
8. [Running the Code](#running)
9. [Reporting Errors](#reporting)
10. [Citing Us](#citation)

## <a name="disclaimer"></a>Disclaimer
<p align="justify">
The authors make no warranties about the use of this software. The authors hold no liabilities for the use of this software. The authors do not 
 recommend the use of this software whatsoever. The algorithm is made freely available to assist researchers in simulation studies involving nonconvex hard particles.
 All information contained herein regarding any specific methodology does not constitute or imply its endorsement or recommendation by the authors.
</p>

## <a name="overview"></a>Overview
<p align="justify">
This NVT/NPT Monte Carlo algorithm was developed to investigate the phase behavior of a system of clover-shaped hard particles, a nonconvex geometry formed by the union of four identical cylinders. Because particle interactions are purely hard-core, specialized routines are required to detect overlaps between the cylindrical subunits. In this work, we employ a hybrid overlap-detection routine that combines the methods proposed by Ibarra-Avalos <i>et al.</i> (<a href="https://doi.org/10.1080/08927020701191349"><b>Mol. Simul.</b>, 33, 505-515, 2007</a>), Orellana <i>et al.</i> (<a href="https://doi.org/10.1140/epje/i2018-11657-0"><b>Eur. Phys. J. E</b>, 41, 10, 2018</a>), and Lopes <i>et al.</i> (<a href="https://doi.org/10.1063/5.0040942"><b>J. Chem. Phys.</b>, 154, 104902, 2021</a>), with a minor modification to the disk–rim overlap test introduced in the latter. The algorithm also implements Widom’s particle insertion method to compute the excess chemical potential. In addition, simulations may be performed in the presence of an external orientational field that aligns the particles’ principal symmetry axis along a preferred direction.
</p>

## <a name="features"></a>Features
<p align="justify">
The following features are supported in the current version:
</p>

1. Initial Configurations
    - Packed box configuration
    - Floppy-box configuration (closed-packed structure)

2. Ensembles
    - Canonical (NVT)
    - Isothermal-Isobaric (NPT)
    - Isothermal-Isostress (N&sigma;T)

3. Moves
    - Translation
    - Rotation (Quaternion Algebra)
    - Cubic Expansions/Compressions (Isotropic)
    - Orthorhombic Expansions/Compressions (Anisotropic)
    - Triclinic Deformations

4. Lattice Reduction Algorithms
    - <a href="https://doi.org/10.1063/1.1901585">Gottwald</a>
    - <a href="https://doi.org/10.1007/BF01457454">Lenstra-Lenstra-Lovász</a>

5. Force Fields
    - Hard-core potential
    - Orientational force field

6. Cell Lists

## <a name="language"></a>Language
<p align="justify">
  The main program, subroutines, and modules contain some explanatory comments and are mainly written in Fortran 95. The user can look for more information on Fortran language <a href="https://docs.oracle.com/cd/E19957-01/806-3591/C_f95.html">here</a>.
</p>

## <a name="installation"></a>Building and Compiling
<p align="justify">
  Firstly, you must clone this GitHub repository using the command below:
</p>

```
> git clone https://github.com/LESC-Unicamp/Supplementary-materials/
```

<p align="justify">
  After that, change to the repository directory on your device and open the <code>/src/</code> folder:
</p>

```
cd Supplementary-materials/Phase-behaviour-of-hard-clover-shaped-particles/Monte-Carlo-algorithm/src/
```

<p align="justify">
  The <code>/src/</code> folder contains a 'Makefile' that you can use to compile the standard version of the code.
</p>

<p align="justify">
  To compile it, first remove any object and module files using the <i>clean</i> command:
</p>
  
```
> make clean
```

<p align="justify">
  Then, to compile the source code, run the command below:
</p>

| **Compilation type** | **Command** |
|:---:|:---:|
| <a href="https://github.com/LESC-Unicamp/Supplementary-materials/blob/main/Phase-behaviour-of-hard-clover-shaped-particles/Monte-Carlo-algorithm/src/makefile">Standard</a> | ```make -f makefile``` |

<p align="justify">
  Please note that the compilation supports parallelization via OpenMP. In this case, it is recommended to set the number of threads using the following command:
</p>

```
> export OMP_NUM_THREADS=X
```

<p align="justify">
where <code>X</code> is the number of threads.
</p>

<p align="justify">
  This command will produce an executable named <code>nonconvex.out</code>, which can be found in the folder <code>/bin/</code> in the repository directory. Before running the program, there are a few initialization variables and options you need to set up.
</p>

## <a name="datainput"></a>Data Input

<p align="justify">
  Apart from the executable file, the <code>/bin/</code> folder contains some initialization files that need to be set up.
</p>

### The Configuration File<br><a href="https://github.com/LESC-Unicamp/Supplementary-materials/blob/main/Phase-behaviour-of-hard-clover-shaped-particles/Monte-Carlo-algorithm/bin/ini_initial_configuration.ini"><sub>ini_initial_configuration.ini</sub></a>

<p align="justify">
  This file is used to set up the molecular geometry and the molecular configuration, including aditional information on the packed-box structure (if selected). The table below shows some options that can be used to define the configuration parameters:
</p>

| Name<br> ________________________ | String Name<br> _________________________________ | Definition<br> _______________________________ | Options<br> _________________________________________________ |
|:---:|:---:| --- | --- |
| Configuration selection | <code>MOLECULAR_CONFIGURATION</code> | Use to select the initial configuration | <ul><li><code>PB</code> for a packed-box configuration<sup>1</sup></li><li><code>FB</code> for a floppy-box configuration<sup>2,3</sup></li></ul> |
| Arrangement selection | <code>GEOMETRY_SELECTION</code> | Use to select the molecular geometry based on a common intersection point | <ul><li><code>1</code> for </li><li><code>2</code> for </li></ul> |
| Quaternion angle | <code>QUATERNION_ANGLE</code> | Use to select the rotation angle in degrees<br> (PB configuration only) | Any <code>FLOAT</code> number |
| Maximum number of cycles<br> (initial configuration) | <code>MAX_CYCLES_INIT</code> | Use to select the maximum number of cycles to randomize the initial PB configuration | Any <code>INTEGER</code> number |
| Restore backup<br> | <code>RESTORE_BACKUP</code> | Use to restore a previously saved simulation from the point where it stopped | Any positive, non-zero <code>FLOAT</code> number between 0 and 1 |
| Packed-box<br> streching/shrinking factor | <code>BOX_FACTOR</code> | Use to stretch/shrink the packed-box configuration. Greater values help ramdomize the initial configuration. Lower values make the configuration more compact but can increase the chances of overlap. | Any positive, non-zero <code>FLOAT</code> number |

<p align="justify">
  <sup><sup>1</sup>The packed-box configuration is a highly packed system but not necessarily the densest crystal configuration. Overlaps may occur if <code>QUATERNION_ANGLE</code> or <code>BOX_FACTOR</code> are not chosen wisely.</sup>
</p>

<p align="justify">
  <sup><sup>2</sup>The floppy-box configuration represents the closed-packed configuration, determined from a floppy-box Monte Carlo simulation.</sup>
</p>

<p align="justify">
  <sup><sup>3</sup>The FB configuration is read from a <code>fbox.dat</code> file, located at <code>/bin/Floppy-box/</code> folder. Please, create the folder if it doesn't exist and place your file there. The file formatting should be:</sup>
</p>

```
Arrangement_type: 2 # (article)
Cylindrical_diameter: D
Cylindrical_length: L
Cylindrical_aspect_ratio: L/D
Box_length: XX, XY, XZ, YZ, YY, YZ, ZX, ZY, ZZ # Unit-cell matrix
Box_volume: V # Volume of the unit cell
Packing_fraction: η # Maximum packing fraction (not necessary)
Number_density: ρ # Maximum number density (not necessary)
Number_of_particles: N # Number of particles in the unit cell
Nematic_order_parameter: S # (not necessary)
 
Positions_and_orientations: 
1, PX, PY, PZ, QW, QX, QY, QZ # Position[X,Y,Z] and Quaternion[W,X,Y,Z]
.
.
.
N, PX, PY, PZ, QW, QX, QY, QZ # Position[X,Y,Z] and Quaternion[W,X,Y,Z]
```

<code>[DATE][HOUR]\_initconf\_[CONFIGURATION]\_[GEOMETRY].xyz</code>

<p align="justify">
  The 14-character code is the [DATE][HOUR] descriptor of the filename. You can open this file using any text editor and edit some simulation settings that you find relevant. Please be reminded that editing anything in this file, except the reduced pressure and absolute temperature, may cause the program to detect overlapping configurations in the initial structure.
</p>
